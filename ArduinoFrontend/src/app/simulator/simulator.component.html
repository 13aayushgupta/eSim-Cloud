<!-- As a heading -->
<nav class="navbar navbar-expand-lg navbar-light text-white"
  style="background-color: white;height: 50px; box-shadow: 0 1px 3px #0000003f;">
  <a id="name" style="float:left; color: black;font-size: 16px;" (click)="exitProject()"><span
      id="grad-name">ARDUINO</span>onCloud</a>
  <!-- <a class="navbar-brand" (click)="exitProject()">
    <img src="./assets/icon.png" style="height: 40px;display: none;margin-top:10px;margin-right: 1em;" class="d-block"
      alt="AOC">
  </a> -->
  <!-- <span class="navbar-brand mb-0 font-weight-bold text-dark h1" routerLink="/">Simulator</span> -->
  <form class="project-name" style="min-width: 300px;">
      <input [value]="projectTitle" (focusout)="onFocusOut($event)" class="text-dark">
    <!-- <input class="form-control mr-sm-2 text-dark" type="text" value={{projectTitle}} aria-label="text"
      id="project-title" > -->
  </form>
  <div class="collapse navbar-collapse">
    <ul class="navbar-nav mr-auto">
      <!-- <li id="projectid" class="nav-item dropdown text-white"> -->
      <!-- <a class="nav-link dropdown-toggle text-dark" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" -->
      <!-- aria-haspopup="true" aria-expanded="false"> -->
      <!-- Project -->
      <!-- </a> -->
      <!-- <div class="dropdown-menu" aria-labelledby="navbarDropdown" style="z-index: 1001;background-color: #b8b8b8;"> -->
      <!-- <a class="dropdown-item text-dark" [routerLink]="['/simulator']" target="_blank">New Project</a> -->
      <!-- <a class="dropdown-item text-dark" (click)="openProject()">Clear Project</a> -->
      <!-- <a class="dropdown-item text-dark" (click)="SaveProject()">Save</a> -->
      <!-- <a class="dropdown-item text-dark" (click)="SaveProjectOff()">Save Temporary</a> -->
      <!-- </div> -->
      <!-- </li> -->
      <!-- <li class="nav-item"> -->
      <!-- <a class="nav-link text-dark" id="navbarDropdown" role="button" (click)="openDialog()"> -->
      <!-- Export -->
      <!-- </a> -->
      <!-- <button mat-button class="text-dark m-auto" >
          Export
        </button> -->
      <!-- </li> -->
      <!-- <li class="nav-item dropdown text-white">
        <a class="nav-link dropdown-toggle text-dark" id="navbarDropdown" role="button" data-toggle="dropdown"
          aria-haspopup="true" aria-expanded="false">
          View
        </a>
        <div class="dropdown-menu" style="background-color: #b8b8b8" aria-labelledby="navbarDropdown">
          <a class="dropdown-item text-dark" role="button" (click)="openview()">Component List</a>
        </div>
      </li> -->
    </ul>

    <div class="topnav" *ngIf="ltiId || ltiNonce || ltiUserId">
      <span style="color: #808080; margin-right: 10px;">Last saved: {{ getFormattedDate(saveTime) }}</span>
      <b style="color: #ff0000;">ASSIGNMENT</b>
    </div>

    <div class="topnav" *ngIf="!ltiId && !ltiNonce && !ltiUserId">
      <!--Add EDITOR button when not on Simulator Page-->
      <a id="login" *ngIf="!token" (click)="HandleRouter(Login())">LOGIN</a>
      <a href="#">HELP</a>
      <a [routerLink]="" (click)="HandleRouter(RouteToFunction('/dashboard/gallery'))">GALLERY</a>
      <a [routerLink]="" (click)="HandleRouter(RouteToFunction('/dashboard'))">DASHBOARD</a>
      <a [routerLink]="" (click)="HandleRouter(RouteToFunction(window.location.protocol + '//' + window.location.hostname, true))">HOME</a>
      <!--<a mat-raised-button
        (click)="HandleRouter(RouteToFunction(window.location.protocol + '//' + window.location.hostname, true))"
        class="navBarItem">Home</a>
      <a mat-raised-button (click)="HandleRouter(RouteToFunction('/dashboard'))" class="navBarItem">Dashboard</a>
      <a mat-raised-button (click)="HandleRouter(RouteToFunction('/dashboard/gallery'))" class="navBarItem">Gallery</a>
      <a mat-raised-button (click)="HandleRouter(RouteToSimulator.bind(this))" class="navBarItem">Editor</a>
      <a mat-raised-button *ngIf="!token" (click)="HandleRouter(Login)">Login</a>-->
      <div class="dropdown show" style="margin-left: 10px;margin-top:4px;" *ngIf="token">
        <!-- <img class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown"
          aria-haspopup="true" aria-expanded="false" src="./assets/images/login.svg" width="30" height="30"
          class="d-inline-block align-center" alt="Login Image"> -->
        <div class="circles" id="dropdownMenuLink" data-toggle="dropdown">
          {{ username.charAt(0).toUpperCase() }}
        </div>
        <div class="dropdown-menu dropdown-menu-right" style="background-color: whitesmoke;"
          aria-labelledby="dropdownMenuLink">
          <a *ngIf="username" class="dropdown-item"><i class="fas fa-user mr-1"></i> {{username}}</a>
          <div class="dropdown-divider"></div>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" (click)="Logout()"><i class="fas fa-sign-out-alt mr-1"></i> Logout</a>
        </div>
      </div>
    </div>

    <!-- <div class="navbar-nav ml-auto" *ngIf="token"> -->
    <!--<div class="dropdown my-dropdown" *ngIf="token">
        <div class="w3-dropdown-hover">
          <img src="./assets/images/login.svg" width="30" height="30" class="d-inline-block align-center"
            alt="Login Image">
          <div class="dropdown-content" style="color: #000;z-index: 1001;">
            <div *ngIf="username">
              <i class="fas fa-user" style="margin-left: 5px;"></i> {{username}}
            </div>
            <hr style="margin-top: 5px;margin-bottom: 0;">
            <div>
              <a href="../../"><i class="fa fa-home" style="margin-left: 5px;"></i> Home</a>
            </div>
            <div>
              <a [routerLink]="['/simulator']"><i class="fa fa-plus" style="margin-left: 5px;"></i> New</a>
            </div>
            <div class="list">
              <a [routerLink]="['/dashboard']"><i class="fa fa-credit-card" style="margin-left: 5px;"></i> Dashboard</a>
            </div>
            <div>
              <a [routerLink]="['/gallery']"><i class="fa fa-th" style="margin-left: 5px;"></i> Gallery</a>
            </div>
            <hr style="margin-top: 5px;margin-bottom: 0;">
            <div (click)="Logout()">
              <i class="fas fa-sign-out-alt" style="margin-left: 5px;"></i> Logout
            </div>
          </div>
        </div>
      </div>-->
    <!-- </div> -->


  </div>
</nav>


<!-- start of icon block -->
<div id="secondary-header">
  <!-- <button mat-raised-button class="ml-2 mb-1 mt-1 mr-1 btn-fst" (click)="toggleCodeEditor(codeDiv)"
    [style.background-color]="toggle ? 'white' : 'lightblue'">
    <i class='far fa-file-code'></i>Code</button> -->

  <!-- <button mat-raised-button id="simulate" class="mb-1 mt-1 btn-fst" [disabled]="disabled" (click)="StartSimulation()"
    [style.background-color]="stoggle ? 'white' : 'lightgreen'">
    <i [ngClass]="stoggle ? 'fas fa-play-circle' : 'fas fa-pause-circle'"></i>
    {{ stoggle ? 'Start Simulation' : 'Stop Simulation' }}
  </button> -->

  <a href="../arduino/#/simulator" target="_blank">
    <button mat-icon-button matTooltip="New Project">
      <i style="font-size: 20px;color: white;" class='fas fa-folder-open'></i>
    </button>
  </a>


  <button class="hidebtn" mat-icon-button matTooltip="Clear Project" (click)="openProject()">
    <i style="font-size: 20px;color: white;" class="fa fa-times-circle"></i>
  </button>
  <button mat-icon-button matTooltip="Save Project" (click)="SaveProject()">
    <i style="font-size: 20px;color: white;" class="fa fa-cloud"></i>
  </button>
  <button mat-icon-button matTooltip="Save Temporary" (click)="SaveProjectOff()">
    <i style="font-size: 20px;color: white;" class="fa fa-save"></i>
  </button>

  <span class="pipe">|</span>

  <button class="hidebtn" mat-icon-button matTooltip="Undo" (click)="undoChange()" [disabled]="enableButton('undo')">
    <mat-icon style="font-size: 20px;color: white;">undo</mat-icon>
  </button>

  <button class="hidebtn" mat-icon-button matTooltip="Redo" (click)="redoChange()" [disabled]="enableButton('redo')">
    <!-- <i style="font-size: 20px;color: white;" class="fa fa-repeat"></i> -->
    <mat-icon style="font-size: 20px;color: white;">redo</mat-icon>
  </button>

  <button mat-icon-button matTooltip="Zoom in" (click)="zoom(0)"><i style="font-size: 20px;color: white;"
      class="fa fa-search-plus"></i></button>

  <button mat-icon-button matTooltip="Zoom out" (click)="zoom(1)"><i style="font-size: 20px;color: white;"
      class="fa fa-search-minus"></i></button>

  <button class="hidebtn" mat-icon-button matTooltip="Delete" (click)="delete()"><i
      style="font-size: 20px;color: white;" class="fa fa-trash"></i></button>

  <button class="hidebtn" mat-icon-button matTooltip="Auto-arrange wires" (click)="autoLayout()">
    <i style="font-size: 20px;color: white;"
      [ngClass]="{'fa fa-magic': !isAutoLayoutInProgress, 'fas fa-spinner fa-spin': isAutoLayoutInProgress}"></i></button>

  <span class="pipe">|</span>

  <button mat-icon-button [matTooltip]="stoggle ? 'Start Simulation' : 'Stop Simulation'" [disabled]="disabled"
    (click)="StartSimulation()" [style.background-color]="stoggle ? 'transparent' : 'green'">
    <i style="font-size: 20px;color: white;" [ngClass]="stoggle ? 'fas fa-play-circle' : 'fas fa-pause-circle'"></i>
  </button>
  <!--<button class="new-button" [matTooltip]="stoggle ? 'Start Simulation' : 'Stop Simulation'" [disabled]="disabled"
    (click)="StartSimulation()" [style.background-color]="stoggle ? 'transparent' : 'green'">
    <i style="font-size: 20px;color: white;" [ngClass]="stoggle ? 'fas fa-play-circle' : 'fas fa-pause-circle'"></i>
  </button>-->
  <!--simulation loading svg-->
  <div id="simload" style="display:none;height:20%;padding: 10px;">
    <img src="./assets/images/Spin.svg" width="30" height="30">
  </div>
  <!--/simulation loading svg-->

  <button mat-icon-button matTooltip="Code" (click)="toggleCodeEditor(codeDiv)"
    [style.background-color]="toggle ? 'transparent' : 'lightblue'">
    <i style="font-size: 20px;color: white;" class="far fa-file-code"></i>
  </button>

  <button class="hidebtn" mat-icon-button matTooltip="View Component List" (click)="openview()">
    <i style="font-size: 20px;color: white;" class="fa fa-list-alt"></i>
  </button>

  <button mat-icon-button matTooltip="See waveform" (click)="showGraph()"><i style="font-size: 20px;color: white;"
      class="fas fa-chart-line"></i></button>


  <!-- Import export -->
  <span class="pipe">|</span>
  <button mat-icon-button matTooltip="Export JSON file" (click)="exportJson()" id="importBtn">
    <i style="font-size: 20px;color: white;" class="fa fa-upload" id="download_icon"></i>
  </button>

  <button class="hidebtn" mat-icon-button matTooltip="Import JSON file">
    <label style="font-size: 20px;color: white; cursor: pointer; width: 100%;" class="fa fa-download">
      <input class="hidebtn" type="file" style="display: none;" #jsonFile id="jsonFile"
        (change)="importJson(jsonFile.files[0])">
    </label>
  </button>
  <!-- Import export -->

  <button mat-icon-button matTooltip="Download Image" (click)="openDialog()">
    <i style="font-size: 20px;color: white;" class="fa fa-file-export"></i>
  </button>

  <button *ngIf="isStaff" mat-icon-button matTooltip="Add to Gallery"
    style="margin-right: 30px;align-items: center;background: transparent;" (click)="addToGallery()">
    <mat-icon aria-hidden="false" style="font-size: 28px;color: white;" aria-label="Example Add to gallery icon">
      add_photo_alternate</mat-icon>
  </button>

  <span class="pipe" *ngIf="submitButtonVisibility">|</span>

  <mat-form-field *ngIf="submitButtonVisibility">
    <mat-select matInput [(ngModel)]="toBeCompared" placeholder="See Previous Runs"
      (selectionChange)="onSelectionChanges($event)">
      <!-- [compareWith]="compareIds" > -->
      <mat-option>
        None
      </mat-option>
      <ng-container *ngFor="let sim of simData;">
        <mat-option [value]="sim.id">Graph Result - {{ sim.length }} data points</mat-option>
      </ng-container>
    </mat-select>
  </mat-form-field>
  <span class="pipe"></span>
  <button mat-raised-button color="primary" style="margin: 10px 0px;" *ngIf="submitButtonVisibility"
    (click)="SaveLTISubmission()">
    <i style="color: #000;" class="fas fa-paper-plane"></i>
    <span style="color: #000;">
      Submit
    </span>
  </button>
  <!-- Condition to dislay the Submit button is yet to be added -->
  <!-- <button class="btn btn-light btn-sm  mb-1 mt-1 bg-white" style="font-size:20px"><i class="fa fa-reply"></i></button>

  <button class="btn btn-light btn-sm  mb-1 mt-1 bg-white" style="font-size:20px"><i class="fa fa-share"></i></button>

  <button class="btn btn-light btn-sm  mb-1 mt-1 bg-white" style="font-size:20px"><i class="fa fa-link fa-rotate-45"
      style="font-size:20px"></i></button> -->
  <span style="flex:1 1 auto;"></span>

</div>
<!-- end of icon block -->


<div class="code-editor" style="z-index: 1000;" #codeDiv>
  <app-code-editor width="500" height="100" [reinit]="openCodeEditor"></app-code-editor>
</div>



<div class="d-flex" id="wrapper">
  <!-- Sidebar -->
  <div class="border-right" id="sidebar-wrapper" style="background-color:white;">
    <h4 class="component-header">CIRCUIT COMPONENTS</h4>

    <div>
      <button class="card-accordian" (click)="Collapse(generalDiv)">
        General<i style="float: right; padding: 2px 0 0 0; font-size: large;"
        [ngClass]="accordian_toggle['generalDiv'] ?'fas fa-angle-right' : 'fas fa-angle-down'"></i>
      </button>

      <div class="collapse-div" #generalDiv id="generalDiv">
        <div class="component-row" *ngFor="let row of componentsBox.general">
          <div class="component-card" (dblclick)="componentdbClick(item)" *ngFor="let item of row" draggable="true"
            (dragstart)="dragStart($event,item)">
            <img src={{components[item].image}} alt="{{components[item].name}}">
            <label style="font-size: smaller;">{{components[item].name}}</label>
          </div>
        </div>

      </div>
    </div>

    <div>

      <div class="card-accordian" (click)="Collapse(controllerDiv)">
        Controllers<i style="float: right; padding: 2px 0 0 0; font-size: large;"
        [ngClass]="accordian_toggle['controllerDiv'] ?'fas fa-angle-right' : 'fas fa-angle-down'"></i>
      </div>

      <div class="collapse-div" #controllerDiv id="controllerDiv">
        <div class="component-row" *ngFor="let row of componentsBox.controllers">
          <div class="component-card" (dblclick)="componentdbClick(item)" *ngFor="let item of row" draggable="true"
            (dragstart)="dragStart($event,item)">
            <img src={{components[item].image}} alt="{{components[item].name}}">
            <label style="font-size: smaller;">{{components[item].name}}</label>
          </div>
        </div>

      </div>
    </div>

    <div>

      <div class="card-accordian" (click)="Collapse(outputDiv)">
        Output<i style="float: right; padding: 2px 0 0 0; font-size: large;"
        [ngClass]="accordian_toggle['outputDiv'] ?'fas fa-angle-right' : 'fas fa-angle-down'"></i>
      </div>

      <div class="collapse-div" #outputDiv id="outputDiv">
        <div class="component-row" *ngFor="let row of componentsBox.output">
          <div class="component-card" (dblclick)="componentdbClick(item)" *ngFor="let item of row" draggable="true"
            (dragstart)="dragStart($event,item)">
            <img src={{components[item].image}} alt="{{components[item].name}}" style="margin: auto;">
            <label style="font-size: smaller;">{{components[item].name}}</label>
          </div>
          <!-- <div class="component-card">
            <img src="./assets/images/components/Buzzer.png" alt="Buzzer">
            <label>Buzzer</label>
          </div>
          <div class="component-card">
            <img src="./assets/images/components/Buzzer.png" alt="Buzzer">
            <label>Buzzer</label>
          </div> -->
        </div>

      </div>
    </div>

    <div>

      <div class="card-accordian" (click)="Collapse(inputDiv)">
        Input<i style="float: right; padding: 2px 0 0 0; font-size: large;"
        [ngClass]="accordian_toggle['inputDiv'] ?'fas fa-angle-right' : 'fas fa-angle-down'"></i>
      </div>

      <div class="collapse-div" #inputDiv id="inputDiv">
        <div class="component-row" *ngFor="let row of componentsBox.input">
          <div class="component-card" (dblclick)="componentdbClick(item)" *ngFor="let item of row" draggable="true"
            (dragstart)="dragStart($event,item)">
            <img src={{components[item].image}} alt="{{components[item].name}}" style="margin: auto;">
            <label style="font-size: smaller;">{{components[item].name}}</label>
          </div>
        </div>
      </div>
    </div>

    <div>

      <div class="card-accordian" (click)="Collapse(sourceDiv)">
        Sources<i style="float: right; padding: 2px 0 0 0; font-size: large;"
        [ngClass]="accordian_toggle['sourceDiv'] ?'fas fa-angle-right' : 'fas fa-angle-down'"></i>
      </div>
      <div class="collapse-div" #sourceDiv id="sourceDiv">
        <div class="component-row" *ngFor="let row of componentsBox.power">
          <div class="component-card" (dblclick)="componentdbClick(item)" *ngFor="let item of row" draggable="true"
            (dragstart)="dragStart($event,item)">
            <img src={{components[item].image}} alt="{{components[item].name}}">
            <label style="font-size: smaller;">{{components[item].name}}</label>
          </div>
        </div>

      </div>


      <div class="card-accordian" (click)="Collapse(driverDiv)">
        Drivers<i style="float: right; padding: 2px 0 0 0; font-size: large;"
        [ngClass]="accordian_toggle['driverDiv'] ?'fas fa-angle-right' : 'fas fa-angle-down'"></i>
      </div>

      <div class="collapse-div" #driverDiv id="driverDiv">
        <div class="component-row" *ngFor="let row of componentsBox.drivers">
          <div class="component-card" (dblclick)="componentdbClick(item)" *ngFor="let item of row" draggable="true"
            (dragstart)="dragStart($event,item)">
            <img src={{components[item].image}} alt="{{components[item].name}}">
            <label style="font-size: smaller;">{{components[item].name}}</label>
          </div>
        </div>

      </div>

      <div class="card-accordian" (click)="Collapse(miscDiv)">
        Miscellaneous<i style="float: right; padding: 2px 0 0 0; font-size: large;"
        [ngClass]="accordian_toggle['miscDiv'] ?'fas fa-angle-right' : 'fas fa-angle-down'"></i>
      </div>

      <div class="collapse-div" #miscDiv id="miscDiv">
        <div class="component-row" *ngFor="let row of componentsBox.misc">
          <div class="component-card" (dblclick)="componentdbClick(item)" *ngFor="let item of row" draggable="true"
            (dragstart)="dragStart($event,item)">
            <img src={{components[item].image}} alt="{{components[item].name}}">
            <label style="font-size: smaller;">{{components[item].name}}</label>
          </div>
        </div>

      </div>
    </div>

    <app-versioning-panel *ngIf="!submitButtonVisibility" [lti]="submitButtonVisibility"
      (createNewBranch)="createNewBranch($event)"></app-versioning-panel>

  </div>

  <!-- /#sidebar-wrapper -->

  <!-- Page Content -->
  <div id="page-content-wrapper">
    <div id="holder"></div>
  </div>
</div>
<!-- /#page-content-wrapper -->


<div id="propertybox" (mousedown)="propertyMouseDown($event)">
  <div style="display: flex;justify-content: space-between;">
    <h6 class="title">Circuit Info</h6>
    <span style="flex:1 1 auto;"></span>
    <i class='fas fa-arrows-alt' (mousedown)="startPropertyDrag()" style="cursor: move;"></i>
  </div>
  <div class="body" style="display: flex;flex-direction: column;"></div>
  <div *ngIf="showProperty">
    <mat-form-field>
      <mat-label>Name</mat-label>
      <input matInput [(ngModel)]="projectTitle">
    </mat-form-field>
    <mat-form-field class="example-full-width">
      <mat-label>Description</mat-label>
      <textarea matInput [(ngModel)]="description"></textarea>
    </mat-form-field>
  </div>
  <div *ngIf="!showProperty" style="display: flex;margin-top: 10px;">
    <button mat-raised-button color="primary" style="margin-left: auto;" (click)="openInfo()">View Info</button>
  </div>
</div>


<div id="bubblebox"></div>
<!--context menu-->

<div id="contextMenu" class="context-menu">
  <ul>
    <li (click)="copy()">
      <h6><i class="fas fa-copy mr-2"></i>Copy</h6>
    </li>
    <li (click)="paste()">
      <h6><i class="fas fa-paste mr-2"></i>Paste</h6>
    </li>
    <li (click)="delete()">
      <h6><i class="fas fa-trash-alt mr-2"></i>Delete</h6>
    </li>
  </ul>
</div>
<!--/context menu-->
<!--toast message-->
<div id="ToastMessage" class="toast text-white" role="alert" aria-live="assertive" aria-atomic="true">
  <div class="toast-body"></div>
</div>
<!--/toast message-->
<!--console ui-->
<div id="console" style="display: none;">
  <div class="head">
    <button class="btn" style="background-color: white;" (click)="minimizeConsole()"><i
        [ngClass]="atoggle ?'fas fa-angle-up' : 'fas fa-angle-down'"></i></button>
    <button class="btn" style="background:transparent" (click)="expandConsole()"><i
        [ngClass]="toggle1 ? 'fas fa-compress-alt' : 'fas fa-expand-alt'"></i></button>
  </div>
  <div class="body">
    <div id="msg"></div>
    <div>
      <form style="display: flex;">
        <select>
          <option>300</option>
          <option>600</option>
          <option>1200</option>
          <option>2400</option>
          <option>4800</option>
          <option selected>9600</option>
          <option>14400</option>
          <option>19200</option>
          <option>28800</option>
          <option>31250</option>
          <option>38400</option>
          <option>57600</option>
          <option>115200</option>
        </select>
        <input type="text" style="flex:1;" #sin>
        <!--<input class="console-cli" type="text" style="flex:1;" #sin>-->
        <button mat-raised-button style="margin-right: 1px; margin-left: 1px;"
          (click)="PrintToConsole(sin)">Send</button>
        <!--<a id="send-to-console"
          (click)="PrintToConsole(sin)">Send</a>-->
        <button mat-raised-button style="margin-right: 1px;" (click)="clearConsole()">Clear</button>
      </form>
    </div>
  </div>
</div>
<!--/console ui-->
<div id="opendialog" style="display: none;z-index: 1000;">
  <div id="innerdialog">
    <div id="top" style="background-color: transparent; width: 100%; height: 120px;border-radius: 5px;">
      <p style="text-align: center;padding-top: 35px;">Are you sure you want to clear the project?</p>
    </div>
    <div class="modal-footer" style="background-color: transparent;">
      <button type="button" class="btn btn-primary" (click)="ClearProject()">YES</button>
      <button type="button" class="btn btn-secondary" data-dismiss="modal" (click)="closeProject()">NO</button>

    </div>
  </div>
</div>
<app-graphlist #graph (simDataSave)="callGetSimRecord($event)" (updateSimulationDataList)="getSimulations()" [id]="id"
  [lti]="submitButtonVisibility" [saveId]="projectId" *ngIf="graphToggle && isLoaded()"></app-graphlist>